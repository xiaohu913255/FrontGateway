{"remainingRequest":"E:\\Language\\Go\\Project\\Test\\test\\go_gateway_view\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!E:\\Language\\Go\\Project\\Test\\test\\go_gateway_view\\src\\views\\service\\http.vue?vue&type=style&index=0&id=d188f088&scoped=true&lang=css","dependencies":[{"path":"E:\\Language\\Go\\Project\\Test\\test\\go_gateway_view\\src\\views\\service\\http.vue","mtime":1725789930924},{"path":"E:\\Language\\Go\\Project\\Test\\test\\go_gateway_view\\node_modules\\css-loader\\index.js","mtime":499162500000},{"path":"E:\\Language\\Go\\Project\\Test\\test\\go_gateway_view\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"E:\\Language\\Go\\Project\\Test\\test\\go_gateway_view\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"E:\\Language\\Go\\Project\\Test\\test\\go_gateway_view\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"E:\\Language\\Go\\Project\\Test\\test\\go_gateway_view\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\r\n.mixin-components-container {\r\n  background-color: #f0f2f5;\r\n  padding: 30px;\r\n  min-height: calc(100vh - 84px);\r\n}\r\n.component-item{\r\n  min-height: 100px;\r\n}\r\n",{"version":3,"sources":["http.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAwOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"http.vue","sourceRoot":"src/views/service","sourcesContent":["<template>\r\n  <div class=\"mixin-components-container\">\r\n    <el-row>\r\n      <el-card class=\"box-card\">\r\n        <div slot=\"header\" class=\"clearfix\">\r\n          <span v-if=\"isEdit===false\">创建HTTP服务</span>\r\n          <span v-if=\"isEdit===true\">修改HTTP服务</span>\r\n        </div>\r\n        <div style=\"margin-bottom:50px;\">\r\n          <el-form ref=\"form\" :model=\"form\" label-width=\"140px\">\r\n            <el-form-item label=\"服务名称\" class=\"is-required\">\r\n              <el-input v-model=\"form.service_name\" placeholder=\"6-128位字母数字下划线\" :disabled=\"isEdit===true\" />\r\n            </el-form-item>\r\n            <el-form-item label=\"服务描述\" class=\"is-required\">\r\n              <el-input v-model=\"form.service_desc\" placeholder=\"最多255字符，必填\" />\r\n            </el-form-item>\r\n            <el-form-item label=\"接入类型\" class=\"is-required\">\r\n              <el-input v-model=\"form.rule\" :disabled=\"isEdit===true\" placeholder=\"路径格式：/user/,域名格式：www.test.com\" class=\"input-with-select\">\r\n                <el-select slot=\"prepend\" v-model=\"form.rule_type\" placeholder=\"请选择\" style=\"width:80px\" :disabled=\"isEdit===true\">\r\n                  <el-option label=\"路径\" :value=\"0\" />\r\n                  <el-option label=\"域名\" :value=\"1\" />\r\n                </el-select>\r\n              </el-input>\r\n            </el-form-item>\r\n            <el-form-item label=\"支持https\">\r\n              <el-switch\r\n                v-model=\"form.need_https\"\r\n                :active-value=\"1\"\r\n                :inactive-value=\"0\"\r\n              />\r\n              <span style=\"color:#606266;font-weight: 700;\">&nbsp;&nbsp;&nbsp;支持strip_uri&nbsp;&nbsp;</span>\r\n              <el-switch\r\n                v-model=\"form.need_strip_uri\"\r\n                :active-value=\"1\"\r\n                :inactive-value=\"0\"\r\n              />\r\n              <span style=\"color:#606266;font-weight: 700;\">&nbsp;&nbsp;&nbsp;支持websocket&nbsp;&nbsp;</span>\r\n              <el-switch\r\n                v-model=\"form.need_websocket\"\r\n                :active-value=\"1\"\r\n                :inactive-value=\"0\"\r\n              />\r\n            </el-form-item>\r\n            <el-form-item label=\"URL重写\">\r\n              <el-input v-model=\"form.url_rewrite\" type=\"textarea\" autosize placeholder=\"格式：^/gateway/test_service(.*) $1 多条换行\" />\r\n            </el-form-item>\r\n            <el-form-item label=\"Header转换\">\r\n              <el-input v-model=\"form.header_transfor\" type=\"textarea\" autosize placeholder=\"header转换支持 add(增加)/del(删除)/edit(修改) 格式：add headerName headValue\" />\r\n            </el-form-item>\r\n            <el-form-item label=\"开启验证\">\r\n              <el-switch\r\n                v-model=\"form.open_auth\"\r\n                :active-value=\"1\"\r\n                :inactive-value=\"0\"\r\n              />\r\n            </el-form-item>\r\n            <el-form-item label=\"IP白名单\">\r\n              <el-input v-model=\"form.white_list\" type=\"textarea\" autosize placeholder=\"格式：127.0.0.1 多条换行，白名单优先于黑名单\" />\r\n            </el-form-item>\r\n            <el-form-item label=\"IP黑名单\">\r\n              <el-input v-model=\"form.black_list\" type=\"textarea\" autosize placeholder=\"格式：127.0.0.1 多条换行，白名单优先于黑名单\" />\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"客户端限流\">\r\n              <el-input v-model=\"form.clientip_flow_limit\" placeholder=\"0表示无限制\" />\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"服务端限流\">\r\n              <el-input v-model=\"form.service_flow_limit\" placeholder=\"0表示无限制\" />\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"轮询方式\">\r\n              <el-radio-group v-model=\"form.round_type\">\r\n                <el-radio :label=\"0\">random</el-radio>\r\n                <el-radio :label=\"1\">round-robin</el-radio>\r\n                <el-radio :label=\"2\">weight_round-robin</el-radio>\r\n                <el-radio :label=\"3\">ip_hash</el-radio>\r\n              </el-radio-group>\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"IP列表\" class=\"is-required\">\r\n              <el-input v-model=\"form.ip_list\" type=\"textarea\" autosize placeholder=\"格式：127.0.0.1:80 多条换行\" />\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"权重列表\" class=\"is-required\">\r\n              <el-input v-model=\"form.weight_list\" type=\"textarea\" autosize placeholder=\"格式：50 多条换行\" />\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"建立连接超时\">\r\n              <el-input v-model=\"form.upstream_connect_timeout\" placeholder=\"单位s，0表示无限制\" />\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"获取header超时\">\r\n              <el-input v-model=\"form.upstream_header_timeout\" placeholder=\"单位s，0表示无限制\" />\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"链接最大空闲时间\">\r\n              <el-input v-model=\"form.upstream_idle_timeout\" placeholder=\"单位s，0表示无限制\" />\r\n            </el-form-item>\r\n\r\n            <el-form-item label=\"最大空闲链接数\">\r\n              <el-input v-model=\"form.upstream_max_idle\" placeholder=\"0表示无限制\" />\r\n            </el-form-item>\r\n            <el-form-item>\r\n              <el-button type=\"primary\" :disabled=\"submitButDisabled\" @click=\"handleSubmit\">立即提交</el-button>\r\n            </el-form-item>\r\n          </el-form>\r\n        </div>\r\n      </el-card>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { serviceAddHttp, serviceDetail, serviceUpdateHttp } from '@/api/service'\r\nexport default {\r\n  name: 'ServiceCreateHttp',\r\n  data() {\r\n    return {\r\n      isEdit: false,\r\n      submitButDisabled: false,\r\n      form: {\r\n        service_name: '',\r\n        service_desc: '',\r\n        rule_type: 0,\r\n        rule: '',\r\n        need_https: 0,\r\n        need_websocket: 0,\r\n        need_strip_uri: 1,\r\n        url_rewrite: '',\r\n        header_transfor: '',\r\n        round_type: 2,\r\n        ip_list: '',\r\n        weight_list: '',\r\n        upstream_connect_timeout: '',\r\n        upstream_header_timeout: '',\r\n        upstream_idle_timeout: '',\r\n        upstream_max_idle: '',\r\n        open_auth: 0,\r\n        black_list: '',\r\n        white_list: '',\r\n        clientip_flow_limit: '',\r\n        service_flow_limit: ''\r\n      }\r\n    }\r\n  },\r\n  created() {\r\n    const id = this.$route.params && this.$route.params.id\r\n    if (id > 0) {\r\n      this.isEdit = true\r\n      this.fetchData(id)\r\n    }\r\n  },\r\n  methods: {\r\n    fetchData(id) {\r\n      const query = { 'id': id }\r\n      serviceDetail(query).then(response => {\r\n        this.form.id = response.data.info.id\r\n        this.form.load_type = response.data.info.load_type\r\n        this.form.service_name = response.data.info.service_name\r\n        this.form.service_desc = response.data.info.service_desc\r\n        this.form.rule_type = response.data.http_rule.rule_type\r\n        this.form.rule = response.data.http_rule.rule\r\n        this.form.need_https = response.data.http_rule.need_https\r\n        this.form.need_websocket = response.data.http_rule.need_websocket\r\n        this.form.need_strip_uri = response.data.http_rule.need_strip_uri\r\n        this.form.url_rewrite = response.data.http_rule.url_rewrite.replace(/,/g, '\\n')\r\n        this.form.header_transfor = response.data.http_rule.header_transfor.replace(/,/g, '\\n')\r\n        this.form.round_type = response.data.load_balance.round_type\r\n        this.form.round_type = response.data.load_balance.round_type\r\n        this.form.ip_list = response.data.load_balance.ip_list.replace(/,/g, '\\n')\r\n        this.form.weight_list = response.data.load_balance.weight_list.replace(/,/g, '\\n')\r\n        this.form.upstream_connect_timeout = response.data.load_balance.upstream_connect_timeout\r\n        this.form.upstream_header_timeout = response.data.load_balance.upstream_header_timeout\r\n        this.form.upstream_idle_timeout = response.data.load_balance.upstream_idle_timeout\r\n        this.form.upstream_max_idle = response.data.load_balance.upstream_max_idle\r\n        this.form.upstream_max_idle = response.data.load_balance.upstream_max_idle\r\n        this.form.open_auth = response.data.access_control.open_auth\r\n        this.form.black_list = response.data.access_control.black_list.replace(/,/g, '\\n')\r\n        this.form.white_list = response.data.access_control.white_list.replace(/,/g, '\\n')\r\n        this.form.clientip_flow_limit = response.data.access_control.clientip_flow_limit\r\n        this.form.service_flow_limit = response.data.access_control.service_flow_limit\r\n      }).catch(() => {\r\n      })\r\n    },\r\n    handleSubmit() {\r\n      this.submitButDisabled = true\r\n      const query = Object.assign({}, this.form)\r\n      console.log(query)\r\n      query.url_rewrite = query.url_rewrite.replace(/\\n/g, ',')\r\n      query.header_transfor = query.header_transfor.replace(/\\n/g, ',')\r\n      query.ip_list = query.ip_list.replace(/\\n/g, ',')\r\n      query.weight_list = query.weight_list.replace(/\\n/g, ',')\r\n      query.black_list = query.black_list.replace(/\\n/g, ',')\r\n      query.white_list = query.white_list.replace(/\\n/g, ',')\r\n      query.service_flow_limit = Number(query.service_flow_limit)\r\n      query.clientip_flow_limit = Number(query.clientip_flow_limit)\r\n      query.upstream_connect_timeout = Number(query.upstream_connect_timeout)\r\n      query.upstream_header_timeout = Number(query.upstream_header_timeout)\r\n      query.upstream_idle_timeout = Number(query.upstream_idle_timeout)\r\n      query.upstream_max_idle = Number(query.upstream_max_idle)\r\n      if (this.isEdit) {\r\n        serviceUpdateHttp(query).then(response => {\r\n          this.submitButDisabled = false\r\n          this.$notify({\r\n            title: 'Success',\r\n            message: '修改成功',\r\n            type: 'success',\r\n            duration: 2000\r\n          })\r\n        }).catch(() => {\r\n          this.submitButDisabled = false\r\n        })\r\n      } else {\r\n        serviceAddHttp(query).then(response => {\r\n          this.submitButDisabled = false\r\n          this.$notify({\r\n            title: 'Success',\r\n            message: '添加成功',\r\n            type: 'success',\r\n            duration: 2000\r\n          })\r\n        }).catch(() => {\r\n          this.submitButDisabled = false\r\n        })\r\n      }\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.mixin-components-container {\r\n  background-color: #f0f2f5;\r\n  padding: 30px;\r\n  min-height: calc(100vh - 84px);\r\n}\r\n.component-item{\r\n  min-height: 100px;\r\n}\r\n</style>\r\n"]}]}